image: ubuntu:latest

before_script:
  - apt update -yq
  - apt install -yq ca-certificates curl
  - echo "deb [trusted=yes] https://packages.twingate.com/apt/ /" | tee /etc/apt/sources.list.d/twingate.list
  - apt update -yq
  - apt install -yq twingate
  - echo "${TWINGATE_SERVICE_ACCOUNT}" | base64 --decode | twingate setup --headless=-
  - twingate start

test:
  stage: test
  script: |
    cat /var/log/twingated.log
    # test protected resource
    curl -v -m 10 "http://172.30.2.229:3000" > /dev/null
    # test public resource
    # curl -v -m 10 https://www.twingate.com > /dev/null